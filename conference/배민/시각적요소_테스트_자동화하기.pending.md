# 시각적요소 테스트 자동화하기
- 발표자 : 신성환 / 우아한형제들 웹프론트엔드 개발그룹
- 의미론적인 테스트 방법론 및 효용

## 테스트가 뭐예요?
 - 범위
   - 소프트웨어 테스트
 - 테스트 정의
   - 프로덕트가 배포 되기 전에 품질, 성능, 신뢰성을 확립하기 위한 절차
 - 프론트엔드 테스트
   - 화면이 잘 그려지는가?
   - 기능이 잘 동작하는가?
 - 연사님은 무엇을 테스트 했나요?
   - mandao 서비스
     - 우아한형제들 사내 웹앱 자동 빌더
     - 우아한 테크 세미나에서 광고함
     - 자세한 기능
       - 비개발자(마케팅/기획자)가 만다오 GUI로 마크업 및 동작 셋업
       - URL 주소를 갖는 웹 페이지 출력 (프로모션 배너)
       - (배민 내 여러 서비스에서) 만다오 빌드 -> 배너 등록 -> 웹뷰 노출
     - 배포 시 리스크
       - 배포 후 화면이 깨지지 않을까? 
         - (무중단 소프트웨어의 이슈) 안정성 필요
         - 400개의 배너를 (데모 포함) 서빙함
         - 상대적으로 크리티컬하지는 않은 이슈 같음
       - 기능적 오류
         - 1만원 쿠폰을 무제한 제공
         - 상대적으로 크리티컬한 이슈
         - 롤백으로 해결하기에 비용이 많이 듬
           - 이미 제공된 쿠폰은 어떻게?
           - 프로모션 비용은 한정적
    - 결론
      - 휴먼 애러를 방지하기 위한 시각적 요소 자동화를 하자!   

## 어디에 무슨 테스트를 작성했나요?
 1. 시나리오 테스트
   - 예) 이벤트 기간 설정 시나리오
    1. 이벤트 시작기간 선택
    2. 이벤트 종료기간 선택
    3. 이벤트 기간 확인
    4. 쿠폰 생성
    5. 쿠폰 기간 확인
    6. ... etc
 2. 시각적 회귀 테스트
   - 랜더링 결과가 유효한 값인가?
   - CSS 디버깅의 어려운 점
     ```
        <div style="vertical-align" center>가운데로 배치해주세요</div>
     ```
      - 오류를 던지지 않음. 잡아내기 어려운 애러이다.
      - 시각적 회귀 테스트는 필요

## 어떻게 테스트?
 1. 블랙박스 테스트
  - 코드가 눈에 보이지 않음
  - input에 대한 output이 expected 
  - 예)
    - 결제가 잘 동작하는가?
    - 버튼은 잘 눌러지는가?
    - 에러 핸들링은 잘 되는가? 
  2. 화이트박스 테스트
   - 예) 모듈 1,2,3,4, ...n 의 코드가 모두 실행되는가  
   
## 테스트 구축하기
 - Jest, puppeteer 사용
 - Jest
    - JS 테스팅 프레임워크
    - 제공 기능
      -  React, View 등 프로젝트
      -  비동기/병렬 테스트
      -  테스트 커버리지 확인
      -  API mocking
      -  ...etc
 - puppeteer
     - Chrominum 기반 자동화 도구
     - 브라우저에 대한 API 프로토콜
     - 시각적 요소(랜더링)을 위해 브라우저 기반 자동화 도구 니즈 존재
     - 제공 기능
       - 유저 행동 코드화
       - DOM 탐색 및 인터랙션
       - 브라우저 다이얼로그(e.g. alert, confirm) 상호 작용
       - 크롤링
       - ...etc
  - 린하게 빠르게 만들기 가능

## 테스트 구성하기
   - 참고
     -  https://github.com/blueStragglr/visual-regression-test-demo


## 만다오에 적용하기
 - 어려운 점
     - 400 + 갯수의 테스트 갯수
     - 테스트 당 몇 초 단위 소요
     - 모든 앱에 대해서 테스트 불가?
 - 실제 테스트 구성
     - 지원하는 모든 기능을 담은 만다오 웹앱
     - Jest + puppeteer
         - 시나리오 기반
         - pixel-match regression testing
  - 샘플 앱
      - 구성
          -  일반 텍스트
          -  마크업 텍스트
          -  유투브 임베드
          -  이미지
          -  조건 블록
          - 반복 블록
          - 회전 목마
          - ... 등
   - 테스트 구성
        1. 테스트용 로컬서버 구성
        2. Chrominum 실행 및 초기화
        3. 시나리오 수행 및 단계별 이미지 스냅샷
        4. 스냅샷 비교

## 그래서 쓸모가 있었나요?
 - 에러 검거 사례

## 기타
 - 구글이 앵귤러 버렸다... deprecated 처리됨

## 참고
 - https://www.youtube.com/watch?v=9AUEfGZslmw 우아한Tech [LIVE 시각적요소 테스트 자동화하기 ::1월 우아한테크세미나]
 - 